# ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3: ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ API ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ PHP PDO

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3 ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ RESTful API ‡∏î‡πâ‡∏ß‡∏¢ PHP PDO ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏µ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏¥‡∏£‡πå‡∏ã ‡πÇ‡∏î‡∏¢‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `api_db` ‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö API, ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ HTTP Methods, ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ JSON, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏≤‡∏£‡∏≤‡∏á `addresses`, `payments`, ‡πÅ‡∏•‡∏∞ `reviews`

## ‚ú≥Ô∏è ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
1. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á RESTful API ‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
2. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏±‡∏í‡∏ô‡∏≤ API Endpoint ‡∏î‡πâ‡∏ß‡∏¢ PHP ‡πÅ‡∏•‡∏∞ PDO
3. ‡∏™‡∏£‡πâ‡∏≤‡∏á API ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö HTTP Methods: GET, POST, PUT, DELETE
4. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

## üìö ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
- ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î RESTful API ‡πÅ‡∏•‡∏∞ HTTP Methods (GET, POST, PUT, DELETE)
- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Header ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô JSON API (Content-Type: application/json)
- ‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PHP ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ API:
  - GET: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - POST: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - PUT: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  - DELETE: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≥‡∏Ç‡∏≠ (Request)
- ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ SQL ‡∏Å‡∏±‡∏ö PDO ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Prepared Statement)
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Response ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (HTTP Status Codes)
- ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏î‡πâ‡∏ß‡∏¢ Thunder Client

## üß™ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
1. ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `api_db` ‡πÇ‡∏î‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á `addresses`, `payments`, ‡πÅ‡∏•‡∏∞ `reviews`
2. ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö ER Diagram ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
3. ‡∏û‡∏±‡∏í‡∏ô‡∏≤ API Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏î‡πâ‡∏ß‡∏¢ Thunder Client ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON
5. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á API ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ Prepared Statements)

## ‡∏Å‡∏≤‡∏£‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ER Diagram (‡∏Ç‡∏¢‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2)
```
[users] ----(1:N)---- [orders] ----(1:N)---- [order_items]
  |                     |                       |
  |                     |                       |
 (N:1)                 (N:1)                 (N:1)
  |                     |                       |
[products] ----(N:1)---- [categories]       [reviews]
  |                                             |
  |                                             |
 (1:N)                                        (N:1)
  |                                             |
[addresses] ----(1:N)---- [payments]
```

- **‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà**
  - `addresses`: id, user_id, address_line, city, postal_code, country, created_at
  - `payments`: id, order_id, amount, method, status, created_at
  - `reviews`: id, product_id, user_id, rating, comment, created_at
- **‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÉ‡∏´‡∏°‡πà**
  - `users` ‚Üí `addresses`: One-to-Many (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 1 ‡∏Ñ‡∏ô‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà)
  - `orders` ‚Üí `payments`: One-to-Many (‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô)
  - `products` ‚Üí `reviews`: One-to-Many (‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ 1 ‡∏ä‡∏¥‡πâ‡∏ô‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏µ‡∏ß‡∏¥‡∏ß)
  - `users` ‚Üí `reviews`: One-to-Many (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ 1 ‡∏Ñ‡∏ô‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏µ‡∏ß‡∏¥‡∏ß)

### SQL ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
```sql
USE api_db;

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á addresses
CREATE TABLE addresses (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT NOT NULL,
    address_line VARCHAR(255) NOT NULL,
    city VARCHAR(100) NOT NULL,
    postal_code VARCHAR(20) NOT NULL,
    country VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á payments
CREATE TABLE payments (
    id INT PRIMARY KEY AUTO_INCREMENT,
    order_id INT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    method ENUM('credit_card', 'bank_transfer', 'cash') NOT NULL,
    status ENUM('pending', 'completed', 'failed') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id) ON DELETE CASCADE
);

-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á reviews
CREATE TABLE reviews (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    user_id INT NOT NULL,
    rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
    comment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
INSERT INTO addresses (user_id, address_line, city, postal_code, country) VALUES
(1, '123 Main St', 'Bangkok', '10110', 'Thailand'),
(2, '456 Admin Rd', 'Chiang Mai', '50200', 'Thailand');

INSERT INTO payments (order_id, amount, method, status) VALUES
(1, 25500.00, 'credit_card', 'completed');

INSERT INTO reviews (product_id, user_id, rating, comment) VALUES
(1, 1, 5, 'Great laptop, very fast!'),
(2, 1, 4, 'Good smartphone, but battery could be better.');
```

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2)
```
F:\xampp\htdocs\api\
‚îú‚îÄ‚îÄ config.php         # ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚îú‚îÄ‚îÄ index.php          # Router ‡∏´‡∏•‡∏±‡∏Å
‚îú‚îÄ‚îÄ users.php          # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/users
‚îú‚îÄ‚îÄ products.php       # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/products
‚îú‚îÄ‚îÄ categories.php     # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/categories
‚îú‚îÄ‚îÄ orders.php         # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/orders
‚îú‚îÄ‚îÄ order_items.php    # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/orders/{id}/items
‚îú‚îÄ‚îÄ addresses.php      # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/addresses
‚îú‚îÄ‚îÄ payments.php       # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/payments
‚îú‚îÄ‚îÄ reviews.php        # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/reviews
‚îú‚îÄ‚îÄ .htaccess          # Rewrite rules
```

### ‡πÑ‡∏ü‡∏•‡πå `.htaccess` (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2)
```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [L]
```

### ‡πÑ‡∏ü‡∏•‡πå `config.php` (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2)
```php
<?php
$host = "localhost";
$username = "root";
$password = "";
$dbname = "api_db";

try {
    $conn = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $conn->exec("SET NAMES utf8");
} catch (PDOException $e) {
    http_response_code(500);
    echo json_encode(["error" => "Connection failed: " . $e->getMessage()]);
    exit();
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `index.php` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)
```php
<?php
header("Content-Type: application/json; charset=UTF-8");
require_once "config.php";

$method = $_SERVER['REQUEST_METHOD'];
$uri = $_SERVER['REQUEST_URI'];
$path = parse_url($uri, PHP_URL_PATH);
$request = explode('/', trim($path, '/'));
$response = [];
$http_code = 200;

if (count($request) >= 2 && $request[0] === 'api') {
    $resource = $request[1] ?? '';
    switch ($resource) {
        case 'users':
            require_once "users.php";
            break;
        case 'products':
            require_once "products.php";
            break;
        case 'categories':
            require_once "categories.php";
            break;
        case 'orders':
            if (isset($request[3]) && $request[3] === 'items') {
                require_once "order_items.php";
            } else {
                require_once "orders.php";
            }
            break;
        case 'addresses':
            require_once "addresses.php";
            break;
        case 'payments':
            require_once "payments.php";
            break;
        case 'reviews':
            require_once "reviews.php";
            break;
        default:
            $response = ["error" => "Endpoint not found"];
            $http_code = 404;
            break;
    }
} else {
    $response = ["error" => "Invalid API endpoint"];
    $http_code = 404;
}

http_response_code($http_code);
echo json_encode($response);
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `addresses.php`
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'addresses') {
    if ($method === 'GET') {
        if (isset($request[2]) && is_numeric($request[2])) {
            try {
                $id = $request[2];
                $sql = "SELECT * FROM addresses WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                $address = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($address) {
                    $response = $address;
                    $http_code = 200;
                } else {
                    $response = ["error" => "Address not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            try {
                $stmt = $conn->query("SELECT * FROM addresses");
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST') {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['user_id']) && !empty($data['address_line']) && !empty($data['city']) && !empty($data['postal_code']) && !empty($data['country'])) {
            try {
                $user_id = $data['user_id'];
                $address_line = $data['address_line'];
                $city = $data['city'];
                $postal_code = $data['postal_code'];
                $country = $data['country'];

                $sql = "INSERT INTO addresses (user_id, address_line, city, postal_code, country) 
                        VALUES (:user_id, :address_line, :city, :postal_code, :country)";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
                $stmt->bindParam(':address_line', $address_line, PDO::PARAM_STR);
                $stmt->bindParam(':city', $city, PDO::PARAM_STR);
                $stmt->bindParam(':postal_code', $postal_code, PDO::PARAM_STR);
                $stmt->bindParam(':country', $country, PDO::PARAM_STR);
                $stmt->execute();
                $response = ["message" => "Address created successfully"];
                $http_code = 201;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['user_id']) && !empty($data['address_line']) && !empty($data['city']) && !empty($data['postal_code']) && !empty($data['country'])) {
            try {
                $id = $request[2];
                $user_id = $data['user_id'];
                $address_line = $data['address_line'];
                $city = $data['city'];
                $postal_code = $data['postal_code'];
                $country = $data['country'];

                $sql = "UPDATE addresses SET user_id = :user_id, address_line = :address_line, 
                        city = :city, postal_code = :postal_code, country = :country WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
                $stmt->bindParam(':address_line', $address_line, PDO::PARAM_STR);
                $stmt->bindParam(':city', $city, PDO::PARAM_STR);
                $stmt->bindParam(':postal_code', $postal_code, PDO::PARAM_STR);
                $stmt->bindParam(':country', $country, PDO::PARAM_STR);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "Address updated successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Address not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'DELETE' && isset($request[2]) && is_numeric($request[2])) {
        try {
            $id = $request[2];
            $sql = "DELETE FROM addresses WHERE id = :id";
            $stmt = $conn->prepare($sql);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();
            if ($stmt->rowCount() > 0) {
                $response = ["message" => "Address deleted successfully"];
                $http_code = 200;
            } else {
                $response = ["error" => "Address not found"];
                $http_code = 404;
            }
        } catch (PDOException $e) {
            $response = ["error" => "Database error: " . $e->getMessage()];
            $http_code = 500;
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `payments.php`
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'payments') {
    if ($method === 'GET') {
        if (isset($request[2]) && is_numeric($request[2])) {
            try {
                $id = $request[2];
                $sql = "SELECT * FROM payments WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                $payment = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($payment) {
                    $response = $payment;
                    $http_code = 200;
                } else {
                    $response = ["error" => "Payment not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            try {
                $stmt = $conn->query("SELECT * FROM payments");
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST') {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['order_id']) && !empty($data['amount']) && !empty($data['method'])) {
            try {
                $order_id = $data['order_id'];
                $amount = $data['amount'];
                $method = $data['method'];
                $status = $data['status'] ?? 'pending';

                $sql = "INSERT INTO payments (order_id, amount, method, status) 
                        VALUES (:order_id, :amount, :method, :status)";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':order_id', $order_id, PDO::PARAM_INT);
                $stmt->bindParam(':amount', $amount, PDO::PARAM_STR);
                $stmt->bindParam(':method', $method, PDO::PARAM_STR);
                $stmt->bindParam(':status', $status, PDO::PARAM_STR);
                $stmt->execute();
                $response = ["message" => "Payment created successfully"];
                $http_code = 201;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['status'])) {
            try {
                $id = $request[2];
                $status = $data['status'];

                $sql = "UPDATE payments SET status = :status WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->bindParam(':status', $status, PDO::PARAM_STR);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "Payment status updated successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Payment not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `reviews.php`
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'reviews') {
    if ($method === 'GET') {
        if (isset($request[2]) && is_numeric($request[2])) {
            try {
                $id = $request[2];
                $sql = "SELECT * FROM reviews WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                $review = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($review) {
                    $response = $review;
                    $http_code = 200;
                } else {
                    $response = ["error" => "Review not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            try {
                $stmt = $conn->query("SELECT * FROM reviews");
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST') {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['product_id']) && !empty($data['user_id']) && !empty($data['rating'])) {
            try {
                $product_id = $data['product_id'];
                $user_id = $data['user_id'];
                $rating = $data['rating'];
                $comment = $data['comment'] ?? '';

                $sql = "INSERT INTO reviews (product_id, user_id, rating, comment) 
                        VALUES (:product_id, :user_id, :rating, :comment)";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':product_id', $product_id, PDO::PARAM_INT);
                $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
                $stmt->bindParam(':rating', $rating, PDO::PARAM_INT);
                $stmt->bindParam(':comment', $comment, PDO::PARAM_STR);
                $stmt->execute();
                $response = ["message" => "Review created successfully"];
                $http_code = 201;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['rating'])) {
            try {
                $id = $request[2];
                $rating = $data['rating'];
                $comment = $data['comment'] ?? '';

                $sql = "UPDATE reviews SET rating = :rating, comment = :comment WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->bindParam(':rating', $rating, PDO::PARAM_INT);
                $stmt->bindParam(':comment', $comment, PDO::PARAM_STR);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "Review updated successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Review not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'DELETE' && isset($request[2]) && is_numeric($request[2])) {
        try {
            $id = $request[2];
            $sql = "DELETE FROM reviews WHERE id = :id";
            $stmt = $conn->prepare($sql);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();
            if ($stmt->rowCount() > 0) {
                $response = ["message" => "Review deleted successfully"];
                $http_code = 200;
            } else {
                $response = ["error" => "Review not found"];
                $http_code = 404;
            }
        } catch (PDOException $e) {
            $response = ["error" => "Database error: " . $e->getMessage()];
            $http_code = 500;
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤
- **‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•**:
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö MySQL ‡πÅ‡∏•‡∏∞ `config.php`
- **404**:
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `.htaccess` ‡πÅ‡∏•‡∏∞ URL
- **500**:
  - ‡∏î‡∏π log ‡∏ó‡∏µ‡πà `F:\xampp\php\logs\php_error_log`

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 7 ‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô 2568
- ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°: PHP 8.2, XAMPP, Windows 10
- ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏° JWT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï