
## แนวคิดการสอน
การสอนจะใช้แนวทาง **ปฏิบัติควบคู่ทฤษฎี** โดยแบ่งเป็น 5 ขั้นตอน:
1. **แนะนำความปลอดภัยใน API**: อธิบาย JWT, CORS, และ OWASP Top 10
2. **อัปเดตฐานข้อมูล**: เพิ่มฟิลด์และปรับโครงสร้าง
3. **พัฒนา Authentication**: สร้างระบบ Login และ Middleware
4. **เพิ่มความปลอดภัย**: ตั้งค่า CORS และป้องกันช่องโหว่
5. **ทดสอบและปรับปรุง**: ใช้ Thunder Client ทดสอบและดีบัก

### โครงสร้างการสอน
- **ระยะเวลา**: 6 ชั่วโมง (3 ครั้ง ครั้งละ 2 ชั่วโมง)
- **เครื่องมือ**:
  - XAMPP (PHP 8.2, Apache, MySQL)
  - Visual Studio Code (PHP Intelephense, Thunder Client)
  - phpMyAdmin
  - Composer (สำหรับติดตั้ง `firebase/php-jwt`)
- **ผลลัพธ์ที่คาดหวัง**:
  - นักเรียนพัฒนา API ที่ปลอดภัยด้วย JWT และ CORS
  - เข้าใจการป้องกันช่องโหว่และ Role-based Access
  - ทดสอบ API และจัดการข้อผิดพลาดได้


## การสอนในชั้นเรียน

### ครั้งที่ 1: แนวคิดความปลอดภัยและการตั้งค่า JWT (2 ชั่วโมง)
1. **แนะนำความปลอดภัยใน API** (30 นาที):
   - อธิบาย JWT, CORS, และ OWASP Top 10
   - แสดงตัวอย่างการโจมตี SQL Injection และ XSS
2. **ตั้งค่า JWT** (60 นาที):
   - ติดตั้ง `firebase/php-jwt` ด้วย Composer
   - อัปเดต `config.php` และสร้าง `middleware.php`
   - รัน SQL เพื่อเพิ่มฟิลด์ `token` ในตาราง `users`
3. **มอบหมายงาน** (30 นาที):
   - ให้นักเรียนออกแบบ Role-based Access สำหรับ Endpoint

### ครั้งที่ 2: พัฒนา API ด้วย JWT และ Role-based Access (2 ชั่วโมง)
1. **พัฒนา Authentication** (90 นาที):
   - ปรับปรุง `users.php` เพื่อเพิ่ม `POST /api/users/login`
   - เพิ่ม Role-based Access ใน `products.php` และ `reviews.php`
   - แบ่งกลุ่มพัฒนา Endpoint อื่นๆ
2. **ทดสอบเบื้องต้น** (30 นาที):
   - ใช้ Thunder Client ทดสอบ `POST /api/users/login` และ Endpoint ที่ต้องใช้ JWT
   - ตัวอย่าง:
     - **POST /api/users/login**:
       ```json
       {"email": "user1@example.com", "password": "password123"}
       ```
       **Response**:
       ```json
       {"message": "Login successful", "token": "eyJ0...", "user": {...}}
       ```
     - **GET /api/users** (Header: `Authorization: Bearer <token>`):
       **Response** (สำหรับ admin): ดึงข้อมูลผู้ใช้ทั้งหมด

### ครั้งที่ 3: ตั้งค่า CORS และทดสอบความปลอดภัย (2 ชั่วโมง)
1. **ตั้งค่า CORS** (60 นาที):
   - อธิบายการตั้งค่า `Access-Control-Allow-Origin` ใน `middleware.php`
   - ทดสอบ CORS ด้วย Thunder Client
2. **ทดสอบและวิเคราะห์ช่องโหว่** (60 นาที):
   - ให้นักเรียนทดสอบการโจมตี เช่น ส่ง JSON payload ที่ไม่ถูกต้อง
   - วิเคราะห์ log และปรับปรุง API
   - อภิปราย Best Practices เช่น การเก็บ Secret Key ใน `.env`

## แบบฝึกหัด
1. **ออกแบบ Role-based Access**:
   - ออกแบบ Endpoint `GET /api/orders/{user_id}` ที่จำกัดเฉพาะเจ้าของคำสั่งซื้อหรือ admin
2. **เขียนโค้ด**:
   - เพิ่ม DELETE Endpoint ใน `addresses.php` พร้อมตรวจสอบ Role-based
   - สร้าง Endpoint `POST /api/users/logout` เพื่อลบ token
3. **เติมโค้ด**:
   ```php
   $payload = [
       'sub' => $user_id,
       'role' => $role,
       'iat' => time(),
       '____' => time() + (60 * 60)
   ];
   $jwt = JWT::encode($payload, _____, 'HS256');
   ```
