# ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 5 ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á API

‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 5 ‡∏ã‡∏∂‡πà‡∏á‡∏°‡∏∏‡πà‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤ RESTful API ‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ PHP PDO ‡πÅ‡∏•‡∏∞ MySQL ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 2 ‡πÅ‡∏•‡∏∞ 3 ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ HTTP Methods, ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ JWT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Authentication, ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î CORS, ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà OWASP Top 10 ‡πÄ‡∏ä‡πà‡∏ô SQL Injection ‡πÅ‡∏•‡∏∞ XSS

## ‚ú≥Ô∏è ‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
1. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô API ‡∏î‡πâ‡∏ß‡∏¢ HTTP Methods
2. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö CRUD ‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• MySQL
3. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÉ‡∏ô API ‡πÄ‡∏ä‡πà‡∏ô CORS, JWT, Authentication
4. ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÉ‡∏ô API

## üìö ‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
- ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ HTTP Methods (GET, POST, PUT, DELETE) ‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢ SQL (MySQL) ‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î NoSQL
- ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ JWT (JSON Web Token) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Authentication
- ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (Role-based Access)
- ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Middleware ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `password_hash()` ‡πÅ‡∏•‡∏∞ `password_verify()`
- ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà OWASP Top 10 ‡πÄ‡∏ä‡πà‡∏ô SQL Injection, XSS
- ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î HTTP Headers ‡πÅ‡∏•‡∏∞ CORS (Cross-Origin Resource Sharing)
- ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ Secure API ‡πÅ‡∏•‡∏∞ Best Practices ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤

## üß™ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ
1. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `api_db` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JWT (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå `token` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `users`)
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö Login API ‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å JWT
3. ‡∏û‡∏±‡∏í‡∏ô‡∏≤ Middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT ‡πÅ‡∏•‡∏∞ Role-based Access
4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS ‡πÅ‡∏•‡∏∞ HTTP Headers ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
5. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö API ‡∏î‡πâ‡∏ß‡∏¢ Thunder Client ‡πÇ‡∏î‡∏¢‡πÅ‡∏ô‡∏ö JWT
6. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á API

## ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå `token` ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á `users` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö JWT (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å token ‡πÉ‡∏´‡∏°‡πà)
- ‡∏Ñ‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3 (`users`, `products`, `categories`, `orders`, `order_items`, `addresses`, `payments`, `reviews`)

### SQL ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
```sql
USE api_db;

-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå token ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á users
ALTER TABLE users ADD COLUMN token TEXT NULL;

-- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ô users
UPDATE users SET token = NULL WHERE id IN (1, 2);
```

## ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3)

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
```
F:\xampp\htdocs\api\
‚îú‚îÄ‚îÄ config.php         # ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
‚îú‚îÄ‚îÄ index.php          # Router ‡∏´‡∏•‡∏±‡∏Å
‚îú‚îÄ‚îÄ middleware.php     # Middleware ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT ‡πÅ‡∏•‡∏∞ CORS
‚îú‚îÄ‚îÄ users.php          # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/users
‚îú‚îÄ‚îÄ products.php       # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/products
‚îú‚îÄ‚îÄ categories.php     # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/categories
‚îú‚îÄ‚îÄ orders.php         # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/orders
‚îú‚îÄ‚îÄ order_items.php    # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/orders/{id}/items
‚îú‚îÄ‚îÄ addresses.php      # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/addresses
‚îú‚îÄ‚îÄ payments.php       # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/payments
‚îú‚îÄ‚îÄ reviews.php        # ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Endpoint /api/reviews
‚îú‚îÄ‚îÄ .htaccess          # Rewrite rules
‚îú‚îÄ‚îÄ composer.json      # ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á firebase/php-jwt
‚îú‚îÄ‚îÄ vendor/            # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏à‡∏≤‡∏Å Composer
```

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á firebase/php-jwt
1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Composer ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
2. ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `C:\xampp\htdocs\api`:
   ```bash
   composer require firebase/php-jwt
   ```
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `vendor` ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå `composer.json` ‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á

### ‡πÑ‡∏ü‡∏•‡πå `composer.json`
```json
{
    "require": {
        "firebase/php-jwt": "^6.10"
    }
}
```

### ‡πÑ‡∏ü‡∏•‡πå `.htaccess` (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3)
```apache
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [L]
```

### ‡πÑ‡∏ü‡∏•‡πå `config.php` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° JWT Secret Key)
```php
<?php
$host = "localhost";
$username = "root";
$password = "";
$dbname = "api_db";

try {
    $conn = new PDO("mysql:host=$host;dbname=$dbname", $username, $password);
    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    $conn->exec("SET NAMES utf8");
} catch (PDOException $e) {
    http_response_code(500);
    echo json_encode(["error" => "Connection failed: " . $e->getMessage()]);
    exit();
}

// JWT Secret Key (‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô .env ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á)
define('JWT_SECRET', 'your-secure-secret-key-1234567890');
define('JWT_ISSUER', 'api_db');
define('JWT_AUDIENCE', 'api_db_client');
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `middleware.php` (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT ‡πÅ‡∏•‡∏∞ CORS)
```php
<?php
require_once "vendor/autoload.php";
use Firebase\JWT\JWT;
use Firebase\JWT\Key;

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS Headers
header("Access-Control-Allow-Origin: *"); // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ó‡∏∏‡∏Å Origin (‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô domain ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á)
header("Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS");
header("Access-Control-Allow-Headers: Content-Type, Authorization");

// ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ OPTIONS request ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö CORS preflight
if ($_SERVER['REQUEST_METHOD'] === 'OPTIONS') {
    http_response_code(200);
    exit();
}

function verifyJWT($conn) {
    $headers = apache_request_headers();
    $authHeader = isset($headers['Authorization']) ? $headers['Authorization'] : null;

    if (!$authHeader || !preg_match('/Bearer\s(\S+)/', $authHeader, $matches)) {
        http_response_code(401);
        echo json_encode(["error" => "No token provided"]);
        exit();
    }

    $jwt = $matches[1];
    try {
        $decoded = JWT::decode($jwt, new Key(JWT_SECRET, 'HS256'));
        $userId = $decoded->sub;

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ token ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        $sql = "SELECT id, role FROM users WHERE id = :id AND token = :token";
        $stmt = $conn->prepare($sql);
        $stmt->bindParam(':id', $userId, PDO::PARAM_INT);
        $stmt->bindParam(':token', $jwt, PDO::PARAM_STR);
        $stmt->execute();
        $user = $stmt->fetch(PDO::FETCH_ASSOC);

        if (!$user) {
            http_response_code(401);
            echo json_encode(["error" => "Invalid token"]);
            exit();
        }

        return $user; // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ user_id ‡πÅ‡∏•‡∏∞ role
    } catch (Exception $e) {
        http_response_code(401);
        echo json_encode(["error" => "Token verification failed: " . $e->getMessage()]);
        exit();
    }
}

function checkRole($user, $requiredRole) {
    if ($user['role'] !== $requiredRole) {
        http_response_code(403);
        echo json_encode(["error" => "Insufficient permissions"]);
        exit();
    }
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `index.php` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Middleware)
```php
<?php
header("Content-Type: application/json; charset=UTF-8");
require_once "config.php";
require_once "middleware.php";

$method = $_SERVER['REQUEST_METHOD'];
$uri = $_SERVER['REQUEST_URI'];
$path = parse_url($uri, PHP_URL_PATH);
$request = explode('/', trim($path, '/'));
$response = [];
$http_code = 200;

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Endpoint ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Authentication (‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô /api/users/login)
if (count($request) >= 2 && $request[0] === 'api' && !($request[1] === 'users' && isset($request[2]) && $request[2] === 'login')) {
    $user = verifyJWT($conn);
}

if (count($request) >= 2 && $request[0] === 'api') {
    $resource = $request[1] ?? '';
    switch ($resource) {
        case 'users':
            require_once "users.php";
            break;
        case 'products':
            require_once "products.php";
            break;
        case 'categories':
            require_once "categories.php";
            break;
        case 'orders':
            if (isset($request[3]) && $request[3] === 'items') {
                require_once "order_items.php";
            } else {
                require_once "orders.php";
            }
            break;
        case 'addresses':
            require_once "addresses.php";
            break;
        case 'payments':
            require_once "payments.php";
            break;
        case 'reviews':
            require_once "reviews.php";
            break;
        default:
            $response = ["error" => "Endpoint not found"];
            $http_code = 404;
            break;
    }
} else {
    $response = ["error" => "Invalid API endpoint"];
    $http_code = 404;
}

http_response_code($http_code);
echo json_encode($response);
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `users.php` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö JWT ‡πÅ‡∏•‡∏∞ Role-based Access)
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}
require_once "vendor/autoload.php";
use Firebase\JWT\JWT;

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'users') {
    if ($method === 'GET') {
        if (isset($request[2]) && is_numeric($request[2])) {
            // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á ID
            if ($user['role'] !== 'admin' && $user['id'] != $request[2]) {
                $response = ["error" => "Insufficient permissions"];
                $http_code = 403;
            } else {
                try {
                    $id = $request[2];
                    $sql = "SELECT id, username, email, first_name, last_name, role, created_at, updated_at 
                            FROM users WHERE id = :id";
                    $stmt = $conn->prepare($sql);
                    $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                    $stmt->execute();
                    $userData = $stmt->fetch(PDO::FETCH_ASSOC);
                    if ($userData) {
                        $response = $userData;
                        $http_code = 200;
                    } else {
                        $response = ["error" => "User not found"];
                        $http_code = 404;
                    }
                } catch (PDOException $e) {
                    $response = ["error" => "Database error: " . $e->getMessage()];
                    $http_code = 500;
                }
            }
        } else {
            // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÑ‡∏î‡πâ
            checkRole($user, 'admin');
            try {
                $sql = "SELECT id, username, email, first_name, last_name, role, created_at, updated_at 
                        FROM users";
                $stmt = $conn->prepare($sql);
                $stmt->execute();
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST' && !isset($request[2])) {
        // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ JWT)
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['username']) && !empty($data['email']) && !empty($data['password'])) {
            try {
                $username = filter_var($data['username'], FILTER_SANITIZE_STRING);
                $email = filter_var($data['email'], FILTER_SANITIZE_EMAIL);
                $password = password_hash($data['password'], PASSWORD_BCRYPT);
                $first_name = filter_var($data['first_name'] ?? '', FILTER_SANITIZE_STRING);
                $last_name = filter_var($data['last_name'] ?? '', FILTER_SANITIZE_STRING);
                $role = $data['role'] ?? 'customer';

                $sql = "INSERT INTO users (username, email, password, first_name, last_name, role) 
                        VALUES (:username, :email, :password, :first_name, :last_name, :role)";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':username', $username, PDO::PARAM_STR);
                $stmt->bindParam(':email', $email, PDO::PARAM_STR);
                $stmt->bindParam(':password', $password, PDO::PARAM_STR);
                $stmt->bindParam(':first_name', $first_name, PDO::PARAM_STR);
                $stmt->bindParam(':last_name', $last_name, PDO::PARAM_STR);
                $stmt->bindParam(':role', $role, PDO::PARAM_STR);
                $stmt->execute();
                $response = ["message" => "User created successfully"];
                $http_code = 201;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'POST' && isset($request[2]) && $request[2] === 'login') {
        // ‡∏£‡∏∞‡∏ö‡∏ö Login ‡∏≠‡∏≠‡∏Å JWT
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['email']) && !empty($data['password'])) {
            try {
                $email = filter_var($data['email'], FILTER_SANITIZE_EMAIL);
                $sql = "SELECT id, username, email, password, role FROM users WHERE email = :email";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':email', $email, PDO::PARAM_STR);
                $stmt->execute();
                $userData = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($userData && password_verify($data['password'], $userData['password'])) {
                    // ‡∏™‡∏£‡πâ‡∏≤‡∏á JWT
                    $payload = [
                        'iss' => JWT_ISSUER,
                        'aud' => JWT_AUDIENCE,
                        'iat' => time(),
                        'exp' => time() + (60 * 60), // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                        'sub' => $userData['id'],
                        'role' => $userData['role']
                    ];
                    $jwt = JWT::encode($payload, JWT_SECRET, 'HS256');

                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï token ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    $sql = "UPDATE users SET token = :token WHERE id = :id";
                    $stmt = $conn->prepare($sql);
                    $stmt->bindParam(':token', $jwt, PDO::PARAM_STR);
                    $stmt->bindParam(':id', $userData['id'], PDO::PARAM_INT);
                    $stmt->execute();

                    $response = [
                        "message" => "Login successful",
                        "token" => $jwt,
                        "user" => [
                            "id" => $userData['id'],
                            "username" => $userData['username'],
                            "email" => $userData['email'],
                            "role" => $userData['role']
                        ]
                    ];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Invalid email or password"];
                    $http_code = 401;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô admin ‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á ID
        if ($user['role'] !== 'admin' && $user['id'] != $request[2]) {
            $response = ["error" => "Insufficient permissions"];
            $http_code = 403;
        } else {
            $data = json_decode(file_get_contents("php://input"), true);
            try {
                $id = $request[2];
                $username = filter_var($data['username'] ?? '', FILTER_SANITIZE_STRING);
                $email = filter_var($data['email'] ?? '', FILTER_SANITIZE_EMAIL);
                $first_name = filter_var($data['first_name'] ?? '', FILTER_SANITIZE_STRING);
                $last_name = filter_var($data['last_name'] ?? '', FILTER_SANITIZE_STRING);
                $role = $data['role'] ?? 'customer';

                $sql = "UPDATE users SET username = :username, email = :email, 
                        first_name = :first_name, last_name = :last_name, role = :role 
                        WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->bindParam(':username', $username, PDO::PARAM_STR);
                $stmt->bindParam(':email', $email, PDO::PARAM_STR);
                $stmt->bindParam(':first_name', $first_name, PDO::PARAM_STR);
                $stmt->bindParam(':last_name', $last_name, PDO::PARAM_STR);
                $stmt->bindParam(':role', $role, PDO::PARAM_STR);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "User updated successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "User not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `products.php` (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ Role-based Access)
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'products') {
    if ($method === 'GET') {
        if (isset($request[2]) && is_numeric($request[2])) {
            try {
                $id = $request[2];
                $sql = "SELECT * FROM products WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                $product = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($product) {
                    $response = $product;
                    $http_code = 200;
                } else {
                    $response = ["error" => "Product not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            try {
                $stmt = $conn->query("SELECT * FROM products");
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST') {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ
        checkRole($user, 'admin');
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['name']) && !empty($data['price'])) {
            try {
                $name = filter_var($data['name'], FILTER_SANITIZE_STRING);
                $price = filter_var($data['price'], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
                $description = filter_var($data['description'] ?? '', FILTER_SANITIZE_STRING);
                $category_id = $data['category_id'] ?? null;
                $stock = $data['stock'] ?? 0;

                $sql = "INSERT INTO products (name, price, description, category_id, stock) 
                        VALUES (:name, :price, :description, :category_id, :stock)";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':name', $name, PDO::PARAM_STR);
                $stmt->bindParam(':price', $price, PDO::PARAM_STR);
                $stmt->bindParam(':description', $description, PDO::PARAM_STR);
                $stmt->bindParam(':category_id', $category_id, PDO::PARAM_INT);
                $stmt->bindParam(':stock', $stock, PDO::PARAM_INT);
                $stmt->execute();
                $response = ["message" => "Product created successfully"];
                $http_code = 201;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ
        checkRole($user, 'admin');
        $data = json_decode(file_get_contents("php://input"), true);
        if (!empty($data['name']) && !empty($data['price'])) {
            try {
                $id = $request[2];
                $name = filter_var($data['name'], FILTER_SANITIZE_STRING);
                $price = filter_var($data['price'], FILTER_SANITIZE_NUMBER_FLOAT, FILTER_FLAG_ALLOW_FRACTION);
                $description = filter_var($data['description'] ?? '', FILTER_SANITIZE_STRING);
                $category_id = $data['category_id'] ?? null;
                $stock = $data['stock'] ?? 0;

                $sql = "UPDATE products SET name = :name, price = :price, description = :description, 
                        category_id = :category_id, stock = :stock WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->bindParam(':name', $name, PDO::PARAM_STR);
                $stmt->bindParam(':price', $price, PDO::PARAM_STR);
                $stmt->bindParam(':description', $description, PDO::PARAM_STR);
                $stmt->bindParam(':category_id', $category_id, PDO::PARAM_INT);
                $stmt->bindParam(':stock', $stock, PDO::PARAM_INT);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "Product updated successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Product not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            $response = ["error" => "Invalid input"];
            $http_code = 400;
        }
    } elseif ($method === 'DELETE' && isset($request[2]) && is_numeric($request[2])) {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ
        checkRole($user, 'admin');
        try {
            $id = $request[2];
            $sql = "DELETE FROM products WHERE id = :id";
            $stmt = $conn->prepare($sql);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();
            if ($stmt->rowCount() > 0) {
                $response = ["message" => "Product deleted successfully"];
                $http_code = 200;
            } else {
                $response = ["error" => "Product not found"];
                $http_code = 404;
            }
        } catch (PDOException $e) {
            $response = ["error" => "Database error: " . $e->getMessage()];
            $http_code = 500;
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

### ‡πÑ‡∏ü‡∏•‡πå `categories.php`, `orders.php`, `order_items.php`, `addresses.php`, `payments.php`, `reviews.php`
- ‡∏Ñ‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ó‡∏µ‡πà 3 ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Role-based Access ‡πÉ‡∏ô Endpoint ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô:
  - `POST`, `PUT`, `DELETE` ‡πÉ‡∏ô `categories.php`, `orders.php`, `payments.php` ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ admin
  - `POST` ‡πÉ‡∏ô `reviews.php`, `addresses.php` ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö customer ‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ `user_id` ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö JWT
- ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö `reviews.php`:
```php
<?php
if (!isset($conn)) {
    require_once "config.php";
}

if (count($request) >= 2 && $request[0] === 'api' && $request[1] === 'reviews') {
    if ($method === 'GET') {
        // ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÑ‡∏î‡πâ
        if (isset($request[2]) && is_numeric($request[2])) {
            try {
                $id = $request[2];
                $sql = "SELECT * FROM reviews WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                $review = $stmt->fetch(PDO::FETCH_ASSOC);
                if ($review) {
                    $response = $review;
                    $http_code = 200;
                } else {
                    $response = ["error" => "Review not found"];
                    $http_code = 404;
                }
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        } else {
            try {
                $stmt = $conn->query("SELECT * FROM reviews");
                $response = $stmt->fetchAll(PDO::FETCH_ASSOC);
                $http_code = 200;
            } catch (PDOException $e) {
                $response = ["error" => "Database error: " . $e->getMessage()];
                $http_code = 500;
            }
        }
    } elseif ($method === 'POST') {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ customer ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÑ‡∏î‡πâ
        if ($user['role'] !== 'customer') {
            $response = ["error" => "Insufficient permissions"];
            $http_code = 403;
        } else {
            $data = json_decode(file_get_contents("php://input"), true);
            if (!empty($data['product_id']) && !empty($data['rating']) && $data['user_id'] == $user['id']) {
                try {
                    $product_id = $data['product_id'];
                    $user_id = $data['user_id'];
                    $rating = filter_var($data['rating'], FILTER_SANITIZE_NUMBER_INT);
                    $comment = filter_var($data['comment'] ?? '', FILTER_SANITIZE_STRING);

                    $sql = "INSERT INTO reviews (product_id, user_id, rating, comment) 
                            VALUES (:product_id, :user_id, :rating, :comment)";
                    $stmt = $conn->prepare($sql);
                    $stmt->bindParam(':product_id', $product_id, PDO::PARAM_INT);
                    $stmt->bindParam(':user_id', $user_id, PDO::PARAM_INT);
                    $stmt->bindParam(':rating', $rating, PDO::PARAM_INT);
                    $stmt->bindParam(':comment', $comment, PDO::PARAM_STR);
                    $stmt->execute();
                    $response = ["message" => "Review created successfully"];
                    $http_code = 201;
                } catch (PDOException $e) {
                    $response = ["error" => "Database error: " . $e->getMessage()];
                    $http_code = 500;
                }
            } else {
                $response = ["error" => "Invalid input or unauthorized user"];
                $http_code = 400;
            }
        }
    } elseif ($method === 'PUT' && isset($request[2]) && is_numeric($request[2])) {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ customer ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
        try {
            $id = $request[2];
            $sql = "SELECT user_id FROM reviews WHERE id = :id";
            $stmt = $conn->prepare($sql);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();
            $review = $stmt->fetch(PDO::FETCH_ASSOC);
            if (!$review || $review['user_id'] != $user['id']) {
                $response = ["error" => "Insufficient permissions"];
                $http_code = 403;
            } else {
                $data = json_decode(file_get_contents("php://input"), true);
                if (!empty($data['rating'])) {
                    $rating = filter_var($data['rating'], FILTER_SANITIZE_NUMBER_INT);
                    $comment = filter_var($data['comment'] ?? '', FILTER_SANITIZE_STRING);

                    $sql = "UPDATE reviews SET rating = :rating, comment = :comment WHERE id = :id";
                    $stmt = $conn->prepare($sql);
                    $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                    $stmt->bindParam(':rating', $rating, PDO::PARAM_INT);
                    $stmt->bindParam(':comment', $comment, PDO::PARAM_STR);
                    $stmt->execute();
                    if ($stmt->rowCount() > 0) {
                        $response = ["message" => "Review updated successfully"];
                        $http_code = 200;
                    } else {
                        $response = ["error" => "Review not found"];
                        $http_code = 404;
                    }
                } else {
                    $response = ["error" => "Invalid input"];
                    $http_code = 400;
                }
            }
        } catch (PDOException $e) {
            $response = ["error" => "Database error: " . $e->getMessage()];
            $http_code = 500;
        }
    } elseif ($method === 'DELETE' && isset($request[2]) && is_numeric($request[2])) {
        // ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ customer ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏´‡∏£‡∏∑‡∏≠ admin ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÑ‡∏î‡πâ
        try {
            $id = $request[2];
            $sql = "SELECT user_id FROM reviews WHERE id = :id";
            $stmt = $conn->prepare($sql);
            $stmt->bindParam(':id', $id, PDO::PARAM_INT);
            $stmt->execute();
            $review = $stmt->fetch(PDO::FETCH_ASSOC);
            if (!$review || ($review['user_id'] != $user['id'] && $user['role'] !== 'admin')) {
                $response = ["error" => "Insufficient permissions"];
                $http_code = 403;
            } else {
                $sql = "DELETE FROM reviews WHERE id = :id";
                $stmt = $conn->prepare($sql);
                $stmt->bindParam(':id', $id, PDO::PARAM_INT);
                $stmt->execute();
                if ($stmt->rowCount() > 0) {
                    $response = ["message" => "Review deleted successfully"];
                    $http_code = 200;
                } else {
                    $response = ["error" => "Review not found"];
                    $http_code = 404;
                }
            }
        } catch (PDOException $e) {
            $response = ["error" => "Database error: " . $e->getMessage()];
            $http_code = 500;
        }
    } else {
        $response = ["error" => "Method not allowed"];
        $http_code = 405;
    }
}
?>
```

## ‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÇ‡∏´‡∏ß‡πà OWASP Top 10
1. **SQL Injection**: ‡πÉ‡∏ä‡πâ Prepared Statements ‡πÅ‡∏•‡∏∞ `bindParam` ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å Query
2. **Broken Authentication**: ‡πÉ‡∏ä‡πâ JWT ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö Secret Key ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
3. **Sensitive Data Exposure**: ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢ `password_hash()` ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏ô Response
4. **XML External Entities (XXE)**: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ XML ‡πÉ‡∏ô API ‡∏ô‡∏µ‡πâ
5. **Broken Access Control**: ‡πÉ‡∏ä‡πâ Role-based Access ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `user_id`
6. **Security Misconfiguration**: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ CORS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ domain ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á
7. **Cross-Site Scripting (XSS)**: ‡πÉ‡∏ä‡πâ `filter_var` ‡πÅ‡∏•‡∏∞ `FILTER_SANITIZE_STRING` ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö input
8. **Insecure Deserialization**: ‡πÉ‡∏ä‡πâ `json_decode` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
9. **Using Components with Known Vulnerabilities**: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï `firebase/php-jwt` ‡∏ú‡πà‡∏≤‡∏ô Composer
10. **Insufficient Logging & Monitoring**: ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å error log ‡πÉ‡∏ô `C:\xampp\php\logs\php_error_log`

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤
- **JWT**:
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á `firebase/php-jwt`
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Secret Key ‡πÉ‡∏ô `config.php`
- **CORS**:
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Headers ‡πÉ‡∏ô `middleware.php`
- **500**:
  - ‡∏î‡∏π log ‡∏ó‡∏µ‡πà `C:\xampp\php\logs\php_error_log`

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: 7 ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2568
- ‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°: PHP 8.2, XAMPP, MySQL, Windows 10
- ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö JWT Secret ‡πÉ‡∏ô `.env` ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏Å‡∏±‡∏î CORS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ domain ‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
- ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£ Rate Limiting ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï